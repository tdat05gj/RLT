<!-- index.html -->
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thống Kê RollerCoin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .card {
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .stats-card {
            transition: transform 0.3s ease;
        }
        .stats-card:hover {
            transform: translateY(-5px);
        }
        .chart-container {
            position: relative;
            margin: auto;
            height: 300px;
        }
    </style>
</head>
<body>
    <div class="container py-5">
        <h1 class="text-center mb-5">Thống Kê RollerCoin</h1>
        
        <!-- Thống kê tổng quan -->
        <div class="row mb-5">
            <div class="col-md-4">
                <div class="card stats-card bg-primary text-white mb-3">
                    <div class="card-body text-center">
                        <h5 class="card-title">Tổng Số Trận</h5>
                        <h2 id="tongSoTran">0</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card stats-card bg-success text-white mb-3">
                    <div class="card-body text-center">
                        <h5 class="card-title">Số Trận Thắng</h5>
                        <h2 id="soTranThang">0</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card stats-card bg-info text-white mb-3">
                    <div class="card-body text-center">
                        <h5 class="card-title">Tỷ Lệ Thắng</h5>
                        <h2 id="tyLeThang">0%</h2>
                    </div>
                </div>
            </div>
        </div>

        <!-- Biểu đồ -->
        <div class="card mb-5">
            <div class="card-body">
                <h5 class="card-title">Biểu Đồ Thống Kê</h5>
                <div class="chart-container">
                    <canvas id="statsChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Bảng dữ liệu chi tiết -->
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Lịch Sử Chi Tiết</h5>
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Thời Gian</th>
                                <th>Tổng Số Trận</th>
                                <th>Số Trận Thắng</th>
                                <th>Tỷ Lệ Thắng</th>
                            </tr>
                        </thead>
                        <tbody id="statsTable">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
    <script>
        let chart;

        // Hàm khởi tạo biểu đồ
        function initChart() {
            const ctx = document.getElementById('statsChart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Tổng Số Trận',
                        data: [],
                        borderColor: 'rgb(13, 110, 253)',
                        tension: 0.1
                    }, {
                        label: 'Số Trận Thắng',
                        data: [],
                        borderColor: 'rgb(25, 135, 84)',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Hàm cập nhật dữ liệu
        async function updateStats() {
            try {
                const response = await fetch('http://localhost:3000/stats');
                const data = await response.json();
                
                if (data.length > 0) {
                    const latest = data[data.length - 1];
                    
                    // Cập nhật thống kê tổng quan
                    document.getElementById('tongSoTran').textContent = latest.tongSoTran;
                    document.getElementById('soTranThang').textContent = latest.soTranThang;
                    const winRate = (latest.soTranThang / latest.tongSoTran * 100).toFixed(1);
                    document.getElementById('tyLeThang').textContent = `${winRate}%`;

                    // Cập nhật biểu đồ
                    chart.data.labels = data.map(item => {
                        const date = new Date(item.thoiGian);
                        return date.toLocaleTimeString();
                    });
                    chart.data.datasets[0].data = data.map(item => item.tongSoTran);
                    chart.data.datasets[1].data = data.map(item => item.soTranThang);
                    chart.update();

                    // Cập nhật bảng
                    const tableBody = document.getElementById('statsTable');
                    tableBody.innerHTML = data.map(item => {
                        const date = new Date(item.thoiGian);
                        const winRate = (item.soTranThang / item.tongSoTran * 100).toFixed(1);
                        return `
                            <tr>
                                <td>${date.toLocaleString()}</td>
                                <td>${item.tongSoTran}</td>
                                <td>${item.soTranThang}</td>
                                <td>${winRate}%</td>
                            </tr>
                        `;
                    }).join('');
                }
            } catch (error) {
                console.error('Lỗi khi cập nhật dữ liệu:', error);
            }
        }

        // Khởi tạo biểu đồ và cập nhật dữ liệu
        initChart();
        updateStats();
        setInterval(updateStats, 5000); // Cập nhật mỗi 5 giây
    </script>
</body>
</html>